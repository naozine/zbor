# Zborï¼ˆãšã¼ã‚‰ï¼‰- ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ  ä»•æ§˜æ›¸

ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0
æœ€çµ‚æ›´æ–°: 2025-12-28

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚³ãƒ³ã‚»ãƒ—ãƒˆ](#2-ã‚³ãƒ³ã‚»ãƒ—ãƒˆ)
3. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#3-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#4-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#5-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
6. [å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#6-å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
7. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#7-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
8. [APIè¨­è¨ˆ](#8-apiè¨­è¨ˆ)
9. [UIç”»é¢æ§‹æˆ](#9-uiç”»é¢æ§‹æˆ)
10. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#10-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
11. [å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º](#11-å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

Zborã¯ã€å¤šæ§˜ãªæƒ…å ±æºï¼ˆYouTubeå‹•ç”»ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã€Webè¨˜äº‹ã€ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’çµ±ä¸€çš„ã«å‡¦ç†ã—ã€æ¤œç´¢å¯èƒ½ãªãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è“„ç©ãƒ»æ´»ç”¨ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- **å¤šæ§˜ãªæƒ…å ±æºã®å–ã‚Šè¾¼ã¿**
  - YouTubeå‹•ç”»ã®URL
  - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä¼šè­°ã®éŒ²éŸ³éŸ³å£°ï¼ˆå˜ä¸€/è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
  - ãƒ‹ãƒ¥ãƒ¼ã‚¹/ãƒ–ãƒ­ã‚°è¨˜äº‹ã®URL
  - Markdown/ãƒ†ã‚­ã‚¹ãƒˆ

- **è‡ªå‹•å‡¦ç†**
  - éŸ³å£°æ–‡å­—èµ·ã“ã—ï¼ˆSherpa-ONNX + ReazonSpeechï¼‰
  - YouTubeå­—å¹•å–å¾—
  - Webè¨˜äº‹æŠ½å‡ºãƒ»å¤‰æ›
  - ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²

- **ãƒŠãƒ¬ãƒƒã‚¸ç®¡ç†**
  - å…¨æ–‡æ¤œç´¢
  - ã‚¿ã‚°ç®¡ç†
  - è¨˜äº‹é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  - LLMé€£æºï¼ˆå°†æ¥ï¼‰

---

## 2. ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

**ã€Œãšã¼ã‚‰ã«æƒ…å ±ã‚’æ”¾ã‚Šè¾¼ã‚€ã ã‘ã§ã€æ•´ç†ã•ã‚ŒãŸãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã«ãªã‚‹ã€**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æƒ…å ±ã®URLã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ•ã’è¾¼ã‚€ã ã‘ã§ã€ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•çš„ã«ï¼š
1. å†…å®¹ã‚’å–å¾—ãƒ»å¤‰æ›
2. æ–‡å­—èµ·ã“ã—ãƒ»æ§‹é€ åŒ–
3. æ¤œç´¢å¯èƒ½ãªè¨˜äº‹ã¨ã—ã¦ä¿å­˜
4. é–¢é€£è¨˜äº‹ã¨ã®ç´ä»˜ã‘

å°†æ¥çš„ã«ã¯LLMã‚’æ´»ç”¨ã—ã¦ï¼š
- è¨˜äº‹ã®è¦ç´„ç”Ÿæˆ
- è¤‡æ•°è¨˜äº‹ã®çµ±åˆãƒ»å†æ§‹æˆ
- ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’ä½¿ã£ãŸæ¨è«–

---

## 3. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Web UI)                     â”‚
â”‚  - è¨˜äº‹ä¸€è¦§ãƒ»é–²è¦§ãƒ»ç·¨é›†                                  â”‚
â”‚  - ã‚½ãƒ¼ã‚¹è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ                                     â”‚
â”‚  - å‡¦ç†çŠ¶æ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Server (Echo)                     â”‚
â”‚  - RESTful API                                           â”‚
â”‚  - WebSocket (å‡¦ç†é€²æ—é€šçŸ¥)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Ingestion â”‚  â”‚  Processing â”‚  â”‚   Storage   â”‚
    â”‚   Pipeline  â”‚  â”‚   Pipeline  â”‚  â”‚   Layer     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Job Queue   â”‚      â”‚   Database   â”‚
        â”‚  (SQLite)    â”‚      â”‚   (SQLite)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **Frontend**: templ + Tailwind CSS ã«ã‚ˆã‚‹Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **API Server**: Echo v4 ã«ã‚ˆã‚‹ RESTful API
- **Ingestion Pipeline**: å„ç¨®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿
- **Processing Pipeline**: æ–‡å­—èµ·ã“ã—ã€å¤‰æ›ã€æ§‹é€ åŒ–
- **Storage Layer**: SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ + ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **Worker**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–å‡¦ç†

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 4.1 Articleï¼ˆè¨˜äº‹ï¼‰

æœ€çµ‚çš„ãªãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®å˜ä½ã€‚

```go
type Article struct {
    // åŸºæœ¬æƒ…å ±
    ID          string    `json:"id"`           // UUID
    Title       string    `json:"title"`        // è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
    Content     string    `json:"content"`      // Markdownæœ¬æ–‡
    Summary     string    `json:"summary,omitempty"` // è¦ç´„

    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆé »ç¹ã«æ¤œç´¢ã•ã‚Œã‚‹é …ç›®ï¼‰
    SourceType  string    `json:"source_type"`  // youtube, audio, url, text
    SourceURL   string    `json:"source_url,omitempty"`
    Author      string    `json:"author,omitempty"`
    PublishedAt *time.Time `json:"published_at,omitempty"`
    Language    string    `json:"language"`     // ja, en

    // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
    CreatedAt   time.Time `json:"created_at"`
    UpdatedAt   time.Time `json:"updated_at"`
    Status      string    `json:"status"`       // draft, published

    // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ï¼‰
    Tags        []Tag             `json:"tags,omitempty"`
    Relations   []ArticleRelation `json:"relations,omitempty"`
    SourceID    string            `json:"source_id,omitempty"`
    ParentID    *string           `json:"parent_id,omitempty"` // LLMå†æ§‹æˆå…ƒ

    // æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
    Sections    []Section         `json:"sections,omitempty"`

    // ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆæŸ”è»Ÿãªæ‹¡å¼µç”¨ï¼‰
    CustomMetadata map[string]interface{} `json:"custom_metadata,omitempty"`
}
```

### 4.2 Sourceï¼ˆã‚½ãƒ¼ã‚¹ï¼‰

å…¥åŠ›ã•ã‚ŒãŸå…ƒãƒ‡ãƒ¼ã‚¿ã€‚

```go
type Source struct {
    ID          string    `json:"id"`
    Type        string    `json:"type"`        // youtube, audio, url, text, markdown
    OriginalURL string    `json:"original_url,omitempty"`
    FilePath    string    `json:"file_path,omitempty"`
    Metadata    string    `json:"metadata"`    // JSON
    CreatedAt   time.Time `json:"created_at"`
    Status      string    `json:"status"`      // pending, processing, completed, failed
}
```

### 4.3 Tagï¼ˆã‚¿ã‚°ï¼‰

```go
type Tag struct {
    ID    int    `json:"id"`
    Name  string `json:"name"`
    Color string `json:"color,omitempty"` // UIç”¨ã®è‰²
}
```

### 4.4 ArticleRelationï¼ˆè¨˜äº‹é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

```go
type ArticleRelation struct {
    FromArticleID string            `json:"from_article_id"`
    ToArticleID   string            `json:"to_article_id"`
    Type          string            `json:"type"` // reference, derived, related, series
    ToArticleTitle string           `json:"to_article_title,omitempty"`
    Metadata      map[string]string `json:"metadata,omitempty"`
}

// ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—
const (
    RelationTypeReference = "reference" // å¼•ç”¨ãƒ»å‚ç…§
    RelationTypeDerived   = "derived"   // LLMã§å†æ§‹æˆ
    RelationTypeRelated   = "related"   // é–¢é€£è¨˜äº‹
    RelationTypeSeries    = "series"    // ã‚·ãƒªãƒ¼ã‚ºç‰©
)
```

### 4.5 Sectionï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

è¨˜äº‹å†…ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ã€‚

```go
type Section struct {
    ID        string `json:"id"`
    Title     string `json:"title"`
    Content   string `json:"content"`           // Markdown
    StartTime *int   `json:"start_time,omitempty"` // ç§’ï¼ˆå‹•ç”»ãƒ»éŸ³å£°ç”¨ï¼‰
    EndTime   *int   `json:"end_time,omitempty"`
    Order     int    `json:"order"`
}
```

### 4.6 ProcessingJobï¼ˆå‡¦ç†ã‚¸ãƒ§ãƒ–ï¼‰

éåŒæœŸå‡¦ç†ã‚¿ã‚¹ã‚¯ã€‚

```go
type ProcessingJob struct {
    ID          string     `json:"id"`
    SourceID    string     `json:"source_id"`
    Type        string     `json:"type"`     // transcribe, fetch, summarize
    Status      string     `json:"status"`   // queued, running, completed, failed
    Priority    int        `json:"priority"` // 0-9 (0ãŒæœ€é«˜å„ªå…ˆåº¦)
    Progress    int        `json:"progress"` // 0-100
    RetryCount  int        `json:"retry_count"`
    Error       string     `json:"error,omitempty"`
    CreatedAt   time.Time  `json:"created_at"`
    StartedAt   *time.Time `json:"started_at,omitempty"`
    CompletedAt *time.Time `json:"completed_at,omitempty"`
}
```

#### ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼è¨­è¨ˆ

**ãƒ¯ãƒ¼ã‚«ãƒ¼è¨­å®šï¼š**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼æ•°: 1ï¼ˆç’°å¢ƒå¤‰æ•° `ZBOR_WORKERS` ã§å¤‰æ›´å¯èƒ½ï¼‰
- éŸ³å£°æ–‡å­—èµ·ã“ã—ã¯CPUè² è·ãŒé«˜ã„ãŸã‚ã€åŒæ™‚å®Ÿè¡Œæ•°ã‚’åˆ¶é™

**ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ï¼š**
- æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°: 3å›
- ãƒªãƒˆãƒ©ã‚¤é–“éš”: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ1åˆ†, 5åˆ†, 15åˆ†ï¼‰
- ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ä¸€æ™‚çš„ãªéšœå®³
- ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡å¤–: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€èªè¨¼ã‚¨ãƒ©ãƒ¼

**ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼š**
- YouTubeå­—å¹•å–å¾—: 60ç§’
- YouTubeéŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: 10åˆ†
- éŸ³å£°æ–‡å­—èµ·ã“ã—: éŸ³å£°é•· Ã— 2ï¼ˆæœ€å¤§60åˆ†ï¼‰
- Webãƒšãƒ¼ã‚¸å–å¾—: 60ç§’

**å„ªå…ˆåº¦ï¼š**
- 0: å³æ™‚å‡¦ç†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¾…æ©Ÿä¸­ï¼‰
- 5: é€šå¸¸å‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- 9: ãƒãƒƒãƒå‡¦ç†ï¼ˆå¤œé–“ãªã©ï¼‰

### 4.7 ProcessingArtifactï¼ˆå‡¦ç†æˆæœç‰©ï¼‰

å‡¦ç†é€”ä¸­ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã€‚

```go
type ProcessingArtifact struct {
    ID        string    `json:"id"`
    SourceID  string    `json:"source_id"`
    Type      string    `json:"type"`     // transcription, summary, translation
    Content   string    `json:"content"`
    Format    string    `json:"format"`   // text, json, srt
    FilePath  string    `json:"file_path,omitempty"`
    Metadata  string    `json:"metadata"` // JSON
    CreatedAt time.Time `json:"created_at"`
}
```

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 5.1 ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```sql
-- è¨˜äº‹ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE articles (
    id TEXT PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    summary TEXT,

    -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆé »ç¹ã«ã‚¯ã‚¨ãƒªã•ã‚Œã‚‹ï¼‰
    source_type TEXT,
    source_url TEXT,
    author TEXT,
    published_at DATETIME,
    language TEXT DEFAULT 'ja',

    -- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    status TEXT DEFAULT 'draft',

    -- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    source_id TEXT,
    parent_id TEXT,

    -- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰
    sections TEXT,
    custom_metadata TEXT,
    embeddings BLOB,

    FOREIGN KEY (source_id) REFERENCES sources(id),
    FOREIGN KEY (parent_id) REFERENCES articles(id)
);

-- å…¨æ–‡æ¤œç´¢ç”¨ä»®æƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆSQLite FTS5 + trigramï¼‰
-- trigramãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã§æ—¥æœ¬èªã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ã«å¯¾å¿œ
CREATE VIRTUAL TABLE articles_fts USING fts5(
    article_id UNINDEXED,
    title,
    content,
    summary,
    tokenize = 'trigram'
);

-- ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    color TEXT,
    created_at DATETIME NOT NULL
);

-- è¨˜äº‹ã¨ã‚¿ã‚°ã®å¤šå¯¾å¤šãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
CREATE TABLE article_tags (
    article_id TEXT,
    tag_id INTEGER,
    PRIMARY KEY (article_id, tag_id),
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

-- è¨˜äº‹é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
CREATE TABLE article_relations (
    from_article_id TEXT,
    to_article_id TEXT,
    relation_type TEXT,
    metadata TEXT,
    created_at DATETIME NOT NULL,
    PRIMARY KEY (from_article_id, to_article_id, relation_type),
    FOREIGN KEY (from_article_id) REFERENCES articles(id) ON DELETE CASCADE,
    FOREIGN KEY (to_article_id) REFERENCES articles(id) ON DELETE CASCADE
);

-- ã‚½ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE sources (
    id TEXT PRIMARY KEY,
    type TEXT NOT NULL,
    original_url TEXT,
    file_path TEXT,
    metadata TEXT,
    created_at DATETIME NOT NULL,
    status TEXT DEFAULT 'pending'
);

-- å‡¦ç†ã‚¸ãƒ§ãƒ–ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE processing_jobs (
    id TEXT PRIMARY KEY,
    source_id TEXT,
    type TEXT NOT NULL,
    status TEXT DEFAULT 'queued',
    progress INTEGER DEFAULT 0,
    error TEXT,
    created_at DATETIME NOT NULL,
    started_at DATETIME,
    completed_at DATETIME,
    FOREIGN KEY (source_id) REFERENCES sources(id) ON DELETE CASCADE
);

-- å‡¦ç†æˆæœç‰©ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE processing_artifacts (
    id TEXT PRIMARY KEY,
    source_id TEXT,
    type TEXT NOT NULL,
    content TEXT,
    format TEXT,
    file_path TEXT,
    metadata TEXT,
    created_at DATETIME NOT NULL,
    FOREIGN KEY (source_id) REFERENCES sources(id) ON DELETE CASCADE
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_articles_created_at ON articles(created_at DESC);
CREATE INDEX idx_articles_source_type ON articles(source_type);
CREATE INDEX idx_articles_status ON articles(status);
CREATE INDEX idx_sources_status ON sources(status);
CREATE INDEX idx_jobs_status ON processing_jobs(status);
```

### 5.2 å…¨æ–‡æ¤œç´¢æˆ¦ç•¥

#### trigramãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼

æ—¥æœ¬èªã¯ç©ºç™½ã§åŒºåˆ‡ã‚‰ã‚Œãªã„ãŸã‚ã€FTS5ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã§ã¯æ¤œç´¢ã§ããªã„ã€‚
trigramãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’3æ–‡å­—ãšã¤ã«åˆ†å‰²ã—ã¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

```
å…¥åŠ›: "ä»Šæ—¥ã¯å¤©æ°—ãŒã„ã„"
ãƒˆãƒ¼ã‚¯ãƒ³: ["ä»Šæ—¥ã¯", "æ—¥ã¯å¤©", "ã¯å¤©æ°—", "å¤©æ°—ãŒ", "æ°—ãŒã„", "ãŒã„ã„"]
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- æ—¥æœ¬èªã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ãŒå¯èƒ½
- å¤–éƒ¨ä¾å­˜ãªã—ï¼ˆMeCabä¸è¦ï¼‰
- SQLite 3.34.0+ ã§æ¨™æº–ã‚µãƒãƒ¼ãƒˆ

**åˆ¶é™:**
- 2æ–‡å­—ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã¯æ¤œç´¢ä¸å¯ï¼ˆtrigramãŒç”Ÿæˆã§ããªã„ï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºãŒã‚„ã‚„å¤§ãããªã‚‹

#### æ¤œç´¢ã‚¯ã‚¨ãƒªã®å‡¦ç†

```go
// æ¤œç´¢ã‚¯ã‚¨ãƒªã®é•·ã•ã«å¿œã˜ã¦æˆ¦ç•¥ã‚’åˆ‡ã‚Šæ›¿ãˆ
func Search(query string) ([]Article, error) {
    runeCount := len([]rune(query))

    if runeCount < 3 {
        // 2æ–‡å­—ä»¥ä¸‹: LIKEã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆä½é »åº¦ãªã®ã§è¨±å®¹ï¼‰
        return db.Query(`
            SELECT * FROM articles
            WHERE content LIKE ? OR title LIKE ?
            ORDER BY created_at DESC`,
            "%"+query+"%", "%"+query+"%")
    }

    // 3æ–‡å­—ä»¥ä¸Š: FTS5ã§é«˜é€Ÿæ¤œç´¢
    return db.Query(`
        SELECT a.* FROM articles a
        JOIN articles_fts f ON a.id = f.article_id
        WHERE articles_fts MATCH ?
        ORDER BY rank`,
        query)
}
```

---

## 6. å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 6.1 YouTubeå‹•ç”»ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. URLå…¥åŠ›
   â†“
2. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€å†ç”Ÿæ™‚é–“ã€ä½œæˆè€…ãªã©ï¼‰
   â†“
3. å­—å¹•å–å¾—ã‚’è©¦è¡Œ
   â”œâ”€ å­—å¹•ã‚ã‚Š â†’ å­—å¹•ã‚’Artifactã¨ã—ã¦ä¿å­˜
   â””â”€ å­—å¹•ãªã— â†’ éŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ æ–‡å­—èµ·ã“ã—
   â†“
4. æ–‡å­—èµ·ã“ã—çµæœã‚’ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æ•´å½¢
   â†“
5. Markdownè¨˜äº‹ç”Ÿæˆ
   â”œâ”€ ã‚¿ã‚¤ãƒˆãƒ«: å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«
   â”œâ”€ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: URLã€ä½œæˆè€…ã€å…¬é–‹æ—¥æ™‚
   â”œâ”€ æœ¬æ–‡: æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆ
   â””â”€ ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: å†ç”Ÿæ™‚é–“ã€ã‚µãƒ ãƒã‚¤ãƒ«ãªã©
   â†“
6. Articleä¿å­˜
   â†“
7. å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°
```

### 6.2 éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

#### å‰æ

è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€å…¨å“¡ãŒåŒæ™‚ã«éŒ²éŸ³é–‹å§‹ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã€‚
ã‚ªãƒ•ã‚»ãƒƒãƒˆæ¤œå‡ºãƒ»éŸ³å£°ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¯ä¸è¦ã€‚

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆå˜ä¸€ or è¤‡æ•°ï¼‰
   â†“
2. éŸ³å£°å½¢å¼æ¤œè¨¼ãƒ»å¤‰æ›ï¼ˆWAV 16kHz ãƒ¢ãƒãƒ©ãƒ«ï¼‰
   â†“
3. è©±è€…æƒ…å ±ã®ä»˜ä¸
   â”œâ”€ å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ« â†’ è©±è€…ä¸æ˜ or ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®š
   â””â”€ è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ« â†’ ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰è©±è€…ãƒ©ãƒ™ãƒ«æŠ½å‡º
   â†“
4. æ–‡å­—èµ·ã“ã—ï¼ˆSherpa-ONNX + ReazonSpeechï¼‰
   â”œâ”€ å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ« â†’ ãã®ã¾ã¾å‡¦ç†
   â””â”€ è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ« â†’ å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å€‹åˆ¥ã«å‡¦ç†
   â†“
5. ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ããƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
   â”œâ”€ å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ« â†’ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ããƒ†ã‚­ã‚¹ãƒˆ
   â””â”€ è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ« â†’ å…¨çµæœã‚’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ã‚½ãƒ¼ãƒˆãƒ»ãƒãƒ¼ã‚¸
   â†“
6. Markdownè¨˜äº‹ç”Ÿæˆ
   â”œâ”€ ã‚¿ã‚¤ãƒˆãƒ«: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› or "ä¼šè­°éŒ² YYYY-MM-DD"
   â”œâ”€ æœ¬æ–‡: è©±è€…ãƒ©ãƒ™ãƒ«ãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãä¼šè­°éŒ²
   â””â”€ ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: éŸ³å£°é•·ã€è©±è€…æƒ…å ±
   â†“
7. Articleä¿å­˜
   â†“
8. å…ƒéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–¢é€£ä»˜ã‘ã¦ä¿æŒ
```

#### è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ä¾‹

```
å…¥åŠ›:
  ç”°ä¸­.m4a â†’ [00:00]ã“ã‚“ã«ã¡ã¯ [00:05]ä»Šæ—¥ã¯...
  ä½è—¤.m4a â†’ [00:02]ã‚ˆã‚ã—ã  [00:08]ã¯ã„

å‡ºåŠ›ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ã‚½ãƒ¼ãƒˆï¼‰:
  [00:00] ç”°ä¸­: ã“ã‚“ã«ã¡ã¯
  [00:02] ä½è—¤: ã‚ˆã‚ã—ã
  [00:05] ç”°ä¸­: ä»Šæ—¥ã¯...
  [00:08] ä½è—¤: ã¯ã„
```

#### éŸ³å£°å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

Sherpa-ONNX + ReazonSpeechã¯ **WAV 16kHz ãƒ¢ãƒãƒ©ãƒ«** å½¢å¼ã‚’è¦æ±‚ã™ã‚‹ã€‚
æ§˜ã€…ãªå…¥åŠ›å½¢å¼ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ffmpegã«ã‚ˆã‚‹å‰å‡¦ç†ã‚’è¡Œã†ã€‚

**ä¾å­˜é–¢ä¿‚ï¼š**
- ffmpegï¼ˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ï¼‰

**å¤‰æ›ã‚³ãƒãƒ³ãƒ‰ï¼š**
```bash
ffmpeg -i input.mp3 -ar 16000 -ac 1 -f wav output.wav
```

**å¯¾å¿œå…¥åŠ›å½¢å¼ï¼š**
- MP3, M4A, AAC, OGG, FLAC, WAV, WebM

**å¤‰æ›å‡¦ç†ã®å®Ÿè£…ï¼ˆå°†æ¥ï¼‰ï¼š**
```go
// internal/asr/converter.go
func ConvertToWav(inputPath, outputPath string) error {
    cmd := exec.Command("ffmpeg",
        "-i", inputPath,
        "-ar", "16000",  // ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ
        "-ac", "1",      // ãƒ¢ãƒãƒ©ãƒ«
        "-f", "wav",
        "-y",            // ä¸Šæ›¸ã
        outputPath,
    )
    return cmd.Run()
}
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼š**
- ffmpegãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ä¾å­˜é–¢ä¿‚ã‚’æ¡ˆå†…
- å¤‰æ›å¤±æ•— â†’ ã‚¸ãƒ§ãƒ–ã‚’failedçŠ¶æ…‹ã«ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¨˜éŒ²

### 6.3 Webè¨˜äº‹ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. URLå…¥åŠ›
   â†“
2. HTMLãƒ•ã‚§ãƒƒãƒ
   â†“
3. è¨˜äº‹æœ¬æ–‡æŠ½å‡ºï¼ˆReadabilityã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
   â†“
4. HTML â†’ Markdownå¤‰æ›
   â†“
5. ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   â†“
6. Markdownè¨˜äº‹ç”Ÿæˆ
   â”œâ”€ ã‚¿ã‚¤ãƒˆãƒ«: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
   â”œâ”€ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: URLã€è‘—è€…ã€å…¬é–‹æ—¥
   â”œâ”€ æœ¬æ–‡: å¤‰æ›ã•ã‚ŒãŸMarkdown
   â””â”€ ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ã‚µã‚¤ãƒˆåã€OGPæƒ…å ±ãªã©
   â†“
7. Articleä¿å­˜
```

### 6.4 ãƒ†ã‚­ã‚¹ãƒˆãƒ»Markdownã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ãƒ†ã‚­ã‚¹ãƒˆ/Markdownå…¥åŠ›ï¼ˆè²¼ã‚Šä»˜ã‘ or ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
   â†“
2. ã‚¿ã‚¤ãƒˆãƒ«æŠ½å‡º or ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
   â†“
3. è»½å¾®ãªæ•´å½¢ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
   â†“
4. Articleä¿å­˜
```

---

## 7. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
zbor/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ server/              # Webã‚µãƒ¼ãƒãƒ¼
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ transcribe/          # éŸ³å£°æ–‡å­—èµ·ã“ã—CLI
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ youtube-caption/     # YouTubeå­—å¹•ãƒ»éŸ³å£°å–å¾—CLI
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ webfetch/            # Webãƒšãƒ¼ã‚¸å–å¾—CLI
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ worker/              # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆå°†æ¥ï¼‰
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ asr/                 # éŸ³å£°èªè­˜ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ config.go        # ãƒ¢ãƒ‡ãƒ«è¨­å®šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ recognizer.go    # Sherpa-ONNXãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â””â”€â”€ result.go        # çµæœå‹ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›
â”‚   â”œâ”€â”€ youtube/             # YouTubeæ“ä½œãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ client.go        # YouTubeã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ caption.go       # å­—å¹•å–å¾—ãƒ»ãƒ‘ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ audio.go         # éŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰
â”‚   â”‚   â””â”€â”€ result.go        # çµæœå‹ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›
â”‚   â”œâ”€â”€ webfetch/            # Webãƒšãƒ¼ã‚¸å–å¾—ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ client.go        # nz-html-fetchãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â””â”€â”€ result.go        # çµæœå‹ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›
â”‚   â”œâ”€â”€ handlers/            # HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ home.go
â”‚   â”‚   â”œâ”€â”€ about.go
â”‚   â”‚   â”œâ”€â”€ articles.go      # è¨˜äº‹ç®¡ç†ï¼ˆå°†æ¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ sources.go       # ã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆå°†æ¥ï¼‰
â”‚   â”‚   â””â”€â”€ jobs.go          # ã‚¸ãƒ§ãƒ–ç®¡ç†ï¼ˆå°†æ¥ï¼‰
â”‚   â”œâ”€â”€ version/             # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
â”‚   â”‚   â””â”€â”€ version.go
â”‚   â”œâ”€â”€ models/              # å®šæ•°ãƒ»ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆãƒ¢ãƒ‡ãƒ«å‹ã¯sqlcç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ article.go       # ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—å®šæ•°ãªã©
â”‚   â”‚   â”œâ”€â”€ source.go        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šæ•°
â”‚   â”‚   â”œâ”€â”€ tag.go
â”‚   â”‚   â””â”€â”€ job.go           # ã‚¸ãƒ§ãƒ–ã‚¿ã‚¤ãƒ—ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šæ•°
â”‚   â”œâ”€â”€ ingestion/           # ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ youtube.go       # internal/youtubeã‚’ä½¿ç”¨
â”‚   â”‚   â”œâ”€â”€ audio.go         # internal/asrã‚’ä½¿ç”¨
â”‚   â”‚   â”œâ”€â”€ url.go           # internal/webfetchã‚’ä½¿ç”¨
â”‚   â”‚   â””â”€â”€ text.go
â”‚   â”œâ”€â”€ processing/          # å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆå°†æ¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ transcriber.go
â”‚   â”‚   â”œâ”€â”€ summarizer.go
â”‚   â”‚   â”œâ”€â”€ converter.go
â”‚   â”‚   â””â”€â”€ pipeline.go
â”‚   â”œâ”€â”€ storage/             # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤
â”‚   â”‚   â”œâ”€â”€ db.go            # DBæ¥ç¶šãƒ»ã‚¹ã‚­ãƒ¼ãƒåˆæœŸåŒ–
â”‚   â”‚   â”œâ”€â”€ schema.sql       # DDLå®šç¾©ï¼ˆembedï¼‰
â”‚   â”‚   â”œâ”€â”€ queries/         # sqlcã‚¯ã‚¨ãƒªå®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ articles.sql
â”‚   â”‚   â”‚   â”œâ”€â”€ sources.sql
â”‚   â”‚   â”‚   â”œâ”€â”€ tags.sql
â”‚   â”‚   â”‚   â””â”€â”€ jobs.sql
â”‚   â”‚   â”œâ”€â”€ sqlc/            # sqlcç”Ÿæˆã‚³ãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ db.go
â”‚   â”‚   â”‚   â”œâ”€â”€ models.go
â”‚   â”‚   â”‚   â””â”€â”€ *.sql.go
â”‚   â”‚   â”œâ”€â”€ article_repository.go
â”‚   â”‚   â”œâ”€â”€ source_repository.go
â”‚   â”‚   â”œâ”€â”€ tag_repository.go
â”‚   â”‚   â””â”€â”€ job_repository.go
â”‚   â””â”€â”€ worker/              # ã‚¸ãƒ§ãƒ–å‡¦ç†ï¼ˆå°†æ¥ï¼‰
â”‚       â”œâ”€â”€ queue.go
â”‚       â””â”€â”€ executor.go
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ home.templ
â”‚   â”‚   â”œâ”€â”€ about.templ
â”‚   â”‚   â”œâ”€â”€ article_list.templ    # å°†æ¥
â”‚   â”‚   â”œâ”€â”€ article_view.templ    # å°†æ¥
â”‚   â”‚   â”œâ”€â”€ article_edit.templ    # å°†æ¥
â”‚   â”‚   â””â”€â”€ source_add.templ      # å°†æ¥
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ base.templ
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ css/
â”‚       â””â”€â”€ js/
â”œâ”€â”€ data/                    # ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ zbor.db              # SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ sources/             # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â””â”€â”€ downloads/
â”‚   â”œâ”€â”€ artifacts/           # å‡¦ç†æˆæœç‰©
â”‚   â”‚   â”œâ”€â”€ transcriptions/
â”‚   â”‚   â”œâ”€â”€ summaries/
â”‚   â”‚   â””â”€â”€ exports/
â”‚   â””â”€â”€ exports/             # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚       â””â”€â”€ markdown/
â”œâ”€â”€ models/                  # ASRãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ sherpa-onnx-zipformer-ja-reazonspeech-2024-08-01/
â”œâ”€â”€ docs/                    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â””â”€â”€ specification.md
â”œâ”€â”€ tmp/                     # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ .air.toml
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

---

## 8. APIè¨­è¨ˆ

### 8.1 è¨˜äº‹ç®¡ç†API

```
GET    /api/articles              è¨˜äº‹ä¸€è¦§å–å¾—
GET    /api/articles/:id          è¨˜äº‹è©³ç´°å–å¾—
POST   /api/articles              è¨˜äº‹ä½œæˆ
PUT    /api/articles/:id          è¨˜äº‹æ›´æ–°
DELETE /api/articles/:id          è¨˜äº‹å‰Šé™¤
GET    /api/articles/search       è¨˜äº‹æ¤œç´¢
  Query Parameters:
    - q: æ¤œç´¢ã‚¯ã‚¨ãƒª
    - tags: ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
    - source_type: ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
    - from: é–‹å§‹æ—¥æ™‚
    - to: çµ‚äº†æ—¥æ™‚
    - limit: å–å¾—ä»¶æ•°
    - offset: ã‚ªãƒ•ã‚»ãƒƒãƒˆ
```

### 8.2 ã‚½ãƒ¼ã‚¹ç®¡ç†API

```
POST   /api/sources               ã‚½ãƒ¼ã‚¹è¿½åŠ 
GET    /api/sources/:id           ã‚½ãƒ¼ã‚¹è©³ç´°å–å¾—
GET    /api/sources/:id/artifacts å‡¦ç†æˆæœç‰©ä¸€è¦§
DELETE /api/sources/:id           ã‚½ãƒ¼ã‚¹å‰Šé™¤
```

### 8.3 å–ã‚Šè¾¼ã¿å‡¦ç†API

```
POST   /api/ingest/youtube        YouTube URLå–ã‚Šè¾¼ã¿
  Body: { "url": "https://...", "title": "..." }

POST   /api/ingest/audio          éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  Content-Type: multipart/form-data

POST   /api/ingest/url            Webè¨˜äº‹URLå–ã‚Šè¾¼ã¿
  Body: { "url": "https://..." }

POST   /api/ingest/text           ãƒ†ã‚­ã‚¹ãƒˆå–ã‚Šè¾¼ã¿
  Body: { "title": "...", "content": "...", "format": "text|markdown" }
```

### 8.4 ã‚¸ãƒ§ãƒ–ç®¡ç†API

```
GET    /api/jobs                  ã‚¸ãƒ§ãƒ–ä¸€è¦§
GET    /api/jobs/:id              ã‚¸ãƒ§ãƒ–è©³ç´°ãƒ»é€²æ—
POST   /api/jobs/:id/cancel       ã‚¸ãƒ§ãƒ–ã‚­ãƒ£ãƒ³ã‚»ãƒ«
WS     /api/jobs/ws               ã‚¸ãƒ§ãƒ–é€²æ—WebSocket
```

### 8.5 ã‚¿ã‚°ç®¡ç†API

```
GET    /api/tags                  ã‚¿ã‚°ä¸€è¦§
POST   /api/tags                  ã‚¿ã‚°ä½œæˆ
PUT    /api/tags/:id              ã‚¿ã‚°æ›´æ–°
DELETE /api/tags/:id              ã‚¿ã‚°å‰Šé™¤
```

### 8.6 è¨˜äº‹ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³API

```
POST   /api/articles/:id/relations     ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
DELETE /api/articles/:id/relations/:to_id  ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤
GET    /api/articles/:id/related       é–¢é€£è¨˜äº‹å–å¾—
```

---

## 9. UIç”»é¢æ§‹æˆ

### 9.1 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

- æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸè¨˜äº‹ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
- å‡¦ç†ä¸­ã®ã‚¸ãƒ§ãƒ–ä¸€è¦§ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼‰
- çµ±è¨ˆæƒ…å ±
  - ç·è¨˜äº‹æ•°
  - ç·ã‚½ãƒ¼ã‚¹æ•°
  - ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¿ã‚°

### 9.2 è¨˜äº‹ä¸€è¦§

- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  - ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠï¼‰
  - ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
  - æ—¥ä»˜ç¯„å›²
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- æ¤œç´¢ãƒãƒ¼ï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰
- ã‚½ãƒ¼ãƒˆ
  - æ–°ã—ã„é †
  - å¤ã„é †
  - ã‚¿ã‚¤ãƒˆãƒ«é †
- è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  - ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
  - ãƒªã‚¹ãƒˆè¡¨ç¤º

### 9.3 è¨˜äº‹é–²è¦§

- Markdownãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ç›®æ¬¡ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
  - ã‚½ãƒ¼ã‚¹æƒ…å ±
  - ã‚¿ã‚°
  - ä½œæˆæ—¥æ™‚ãƒ»æ›´æ–°æ—¥æ™‚
- é–¢é€£è¨˜äº‹ãƒªãƒ³ã‚¯
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
  - ç·¨é›†
  - å‰Šé™¤
  - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### 9.4 è¨˜äº‹ç·¨é›†

- Markdownã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä»˜ãï¼‰
- ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†
- ã‚¿ã‚°ç·¨é›†ï¼ˆè‡ªå‹•è£œå®Œï¼‰
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç·¨é›†
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
- ä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³

### 9.5 ã‚½ãƒ¼ã‚¹è¿½åŠ 

ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆå¼ã®ãƒ•ã‚©ãƒ¼ãƒ ï¼š

**YouTubeã‚¿ãƒ–ï¼š**
- URLå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ã‚¿ã‚°é¸æŠ

**éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–ï¼š**
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ
- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›
- è©±è€…æƒ…å ±å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**Webè¨˜äº‹ã‚¿ãƒ–ï¼š**
- URLå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³

**ãƒ†ã‚­ã‚¹ãƒˆã‚¿ãƒ–ï¼š**
- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›
- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠï¼ˆPlain Text / Markdownï¼‰

---

## 10. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 10.1 æ—¢å­˜æŠ€è¡“ï¼ˆç¶™ç¶šä½¿ç”¨ï¼‰

- **Go 1.25**: ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª
- **Echo v4**: HTTPãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **templ**: å‹å®‰å…¨ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³
- **Tailwind CSS**: CSSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆCDNï¼‰
- **Air**: ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰é–‹ç™ºãƒ„ãƒ¼ãƒ«
- **Sherpa-ONNX v1.12.20**: éŸ³å£°èªè­˜ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **ReazonSpeech**: æ—¥æœ¬èªASRãƒ¢ãƒ‡ãƒ«

### 10.2 æ–°è¦è¿½åŠ äºˆå®š

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼š**
- SQLite3ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
- modernc.org/sqliteï¼ˆPure Go SQLiteãƒ‰ãƒ©ã‚¤ãƒãƒ¼ï¼‰
- sqlcï¼ˆSQLã‹ã‚‰Goå‹å®‰å…¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼‰

**HTML/Webå‡¦ç†ï¼š**
- goqueryï¼ˆHTMLè§£æï¼‰
- html-to-markdownï¼ˆHTMLâ†’Markdownå¤‰æ›ï¼‰

**ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼š**
- google/uuidï¼ˆUUIDç”Ÿæˆï¼‰
- fsnotifyï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ»å°†æ¥ï¼‰

**LLMé€£æºï¼ˆå°†æ¥ï¼‰ï¼š**
- OpenAI Go SDK
- Anthropic Go SDK

---

## 11. å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤æ§‹ç¯‰ âœ… å®Œäº†

- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆãƒ»å®Ÿè£…
- [x] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤å®Ÿè£…ï¼ˆrepository ãƒ‘ã‚¿ãƒ¼ãƒ³ + sqlcï¼‰
- [x] åŸºæœ¬çš„ãªCRUD API
- [x] ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼å®Ÿè£…
- [x] è¨˜äº‹ä¸€è¦§ãƒ»è©³ç´°ç”»é¢

**æˆæœç‰©ï¼š**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 
- åŸºæœ¬çš„ãªAPI
- è¨˜äº‹ã®æ‰‹å‹•ä½œæˆãƒ»é–²è¦§ãŒå¯èƒ½

### Phase 2: éŸ³å£°å‡¦ç†çµ±åˆ

- [ ] éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- [ ] ffmpegã«ã‚ˆã‚‹å½¢å¼å¤‰æ›ï¼ˆMP3, M4Aç­‰ â†’ WAV 16kHzï¼‰
- [ ] æ—¢å­˜ASRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆ
- [ ] è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼ˆè©±è€…ãƒ©ãƒ™ãƒ«ãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒãƒ¼ã‚¸ï¼‰
- [ ] éŸ³å£°å–ã‚Šè¾¼ã¿UI

**æˆæœç‰©ï¼š**
- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¨˜äº‹ä½œæˆãŒå¯èƒ½

### Phase 3: YouTubeçµ±åˆ

- [ ] YouTubeå–ã‚Šè¾¼ã¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- [ ] æ—¢å­˜ã®youtube-testã‚³ãƒ¼ãƒ‰ã®çµ±åˆ
- [ ] å­—å¹•å–å¾—ãƒ»éŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- [ ] Markdownè¨˜äº‹ç”Ÿæˆï¼ˆASRã¯Phase 2ã‚’å†åˆ©ç”¨ï¼‰
- [ ] YouTubeå–ã‚Šè¾¼ã¿UI

**æˆæœç‰©ï¼š**
- YouTube URLã‹ã‚‰è¨˜äº‹ä½œæˆãŒå¯èƒ½

### Phase 4: Webè¨˜äº‹å–ã‚Šè¾¼ã¿

- [ ] URLå–ã‚Šè¾¼ã¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- [ ] HTMLè§£æãƒ»è¨˜äº‹æŠ½å‡º
- [ ] HTMLâ†’Markdownå¤‰æ›
- [ ] ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] URLå–ã‚Šè¾¼ã¿UI

**æˆæœç‰©ï¼š**
- Webè¨˜äº‹URLã‹ã‚‰è¨˜äº‹ä½œæˆãŒå¯èƒ½

### Phase 5: è¨˜äº‹ç®¡ç†æ©Ÿèƒ½

- [ ] å…¨æ–‡æ¤œç´¢æ©Ÿèƒ½ï¼ˆFTS5ï¼‰
- [ ] ã‚¿ã‚°ç®¡ç†
- [ ] è¨˜äº‹ç·¨é›†æ©Ÿèƒ½
- [ ] è¨˜äº‹å‰Šé™¤æ©Ÿèƒ½
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½

**æˆæœç‰©ï¼š**
- å®Œå…¨ãªè¨˜äº‹ç®¡ç†æ©Ÿèƒ½

### Phase 6a: LLMåŸºæœ¬çµ±åˆï¼ˆå°†æ¥ï¼‰

é›£æ˜“åº¦: ä½ã€œä¸­

- [ ] LLM APIé€£æºåŸºç›¤ï¼ˆOpenAI / Anthropicï¼‰
- [ ] è¨˜äº‹è¦ç´„ç”Ÿæˆ
- [ ] ã‚¿ã‚°è‡ªå‹•ä»˜ä¸
- [ ] Markdownã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½

**æˆæœç‰©ï¼š**
- è¨˜äº‹ä½œæˆæ™‚ã«è‡ªå‹•è¦ç´„ãƒ»ã‚¿ã‚°ä»˜ã‘

### Phase 6b: é«˜åº¦ãªæ¤œç´¢æ©Ÿèƒ½ï¼ˆå°†æ¥ï¼‰

é›£æ˜“åº¦: ä¸­

- [ ] ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼ˆãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿ï¼‰
- [ ] ãƒ™ã‚¯ãƒˆãƒ«DBçµ±åˆï¼ˆSQLite-vec or å¤–éƒ¨DBï¼‰
- [ ] é¡ä¼¼è¨˜äº‹æ¨è–¦
- [ ] ã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼ï¼ˆè¨˜äº‹é–“ãƒªãƒ³ã‚¯å¯è¦–åŒ–ï¼‰

**æˆæœç‰©ï¼š**
- æ„å‘³ãƒ™ãƒ¼ã‚¹ã®è¨˜äº‹æ¤œç´¢

### Phase 6c: RAGãƒ»é«˜åº¦ãªLLMæ©Ÿèƒ½ï¼ˆå°†æ¥ï¼‰

é›£æ˜“åº¦: é«˜

- [ ] RAGï¼ˆRetrieval-Augmented Generationï¼‰
- [ ] LLMã«ã‚ˆã‚‹è¨˜äº‹å†æ§‹æˆ
- [ ] ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’ä½¿ã£ãŸè³ªå•å¿œç­”
- [ ] ç¿»è¨³æ©Ÿèƒ½

**æˆæœç‰©ï¼š**
- ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’æ´»ç”¨ã—ãŸAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ

### Phase 6d: éŸ³å£°å‡¦ç†ã®é«˜åº¦åŒ–ï¼ˆå°†æ¥ï¼‰

é›£æ˜“åº¦: é«˜ï¼ˆåˆ¥ãƒ¢ãƒ‡ãƒ«å¿…è¦ï¼‰

- [ ] è©±è€…åˆ†é›¢ï¼ˆSpeaker Diarizationï¼‰
- [ ] è©±è€…è­˜åˆ¥ãƒ»ãƒ©ãƒ™ãƒªãƒ³ã‚°
- [ ] æ„Ÿæƒ…åˆ†æ

**æˆæœç‰©ï¼š**
- ä¼šè­°éŒ²ã®è©±è€…åˆ¥æ•´ç†

---

## ä»˜éŒ²

### sqlcè¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`sqlc.yaml`:

```yaml
version: "2"
sql:
  - engine: "sqlite"
    queries: "internal/storage/queries"
    schema: "internal/storage/schema.sql"
    gen:
      go:
        package: "sqlc"
        out: "internal/storage/sqlc"
        emit_json_tags: true
        emit_empty_slices: true
        emit_pointers_for_null_types: true
```

**ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ:**
```bash
sqlc generate
```

**æ³¨æ„äº‹é …:**
- SQLãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã‹ãªã„ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å•é¡Œã‚’å›é¿ï¼‰
- FTS5ã®MATCHæ§‹æ–‡ã¯sqlcã§æ‰±ãˆãªã„ãŸã‚ã€FTSæ¤œç´¢ã¯æ‰‹å‹•SQLã§å®Ÿè£…
- `sqlc.narg()`ã¯SQLiteã§å•é¡ŒãŒã‚ã‚‹ãŸã‚ã€æ¡ä»¶åˆ¥ã«è¤‡æ•°ã‚¯ã‚¨ãƒªã‚’å®šç¾©

---

## ä»˜éŒ²ï¼ˆç¶šãï¼‰

### A. API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

#### è¨˜äº‹è©³ç´°å–å¾—

```json
GET /api/articles/550e8400-e29b-41d4-a716-446655440000

{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "YouTubeå‹•ç”»: AIã®æœªæ¥ã«ã¤ã„ã¦",
  "content": "# AIã®æœªæ¥ã«ã¤ã„ã¦\n\n## ã¯ã˜ã‚ã«\n...",
  "summary": "ã“ã®å‹•ç”»ã§ã¯AIã®å°†æ¥çš„ãªç™ºå±•ã«ã¤ã„ã¦...",
  "source_type": "youtube",
  "source_url": "https://www.youtube.com/watch?v=xxxxx",
  "author": "Tech Channel",
  "published_at": "2025-12-20T10:00:00Z",
  "language": "ja",
  "created_at": "2025-12-28T10:00:00Z",
  "updated_at": "2025-12-28T10:30:00Z",
  "status": "published",

  "tags": [
    {"id": 1, "name": "AI", "color": "#FF5733"},
    {"id": 5, "name": "æŠ€è¡“", "color": "#3498DB"}
  ],

  "relations": [
    {
      "to_article_id": "abc123",
      "type": "related",
      "to_article_title": "æ©Ÿæ¢°å­¦ç¿’ã®åŸºç¤"
    }
  ],

  "sections": [
    {
      "id": "sec1",
      "title": "ã¯ã˜ã‚ã«",
      "content": "ã“ã®å‹•ç”»ã§ã¯...",
      "start_time": 0,
      "end_time": 120,
      "order": 1
    }
  ],

  "custom_metadata": {
    "duration": 1530,
    "view_count": 12345,
    "thumbnail": "https://..."
  }
}
```

### B. Markdownã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼

```markdown
---
id: 550e8400-e29b-41d4-a716-446655440000
title: "YouTubeå‹•ç”»: AIã®æœªæ¥ã«ã¤ã„ã¦"
source_type: youtube
source_url: https://www.youtube.com/watch?v=xxxxx
author: Tech Channel
published_at: 2025-12-20T10:00:00Z
created_at: 2025-12-28T10:00:00Z
language: ja
tags:
  - AI
  - æŠ€è¡“
related:
  - "[[æ©Ÿæ¢°å­¦ç¿’ã®åŸºç¤]]"
---

# AIã®æœªæ¥ã«ã¤ã„ã¦

## ã¯ã˜ã‚ã«

[00:00] ã“ã®å‹•ç”»ã§ã¯...

## AIã®ç¾çŠ¶

[02:00] ç¾åœ¨ã®AIæŠ€è¡“ã¯...
```

---

## ä»˜éŒ²C. ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒæœŸå†ç”Ÿæ©Ÿèƒ½

### æ¦‚è¦

æ–‡å­—èµ·ã“ã—çµæœã¨éŸ³å£°ã‚’åŒæœŸã—ã¦ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨æ©Ÿèƒ½ã€‚
ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è©²å½“ç®‡æ‰€ã‹ã‚‰éŸ³å£°ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿã•ã‚Œã‚‹ã€‚

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- æ–‡å­—èµ·ã“ã—çµæœã®ç²¾åº¦ç¢ºèª
- èª¤èªè­˜ç®‡æ‰€ã®ç‰¹å®šãƒ»ä¿®æ­£
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®ãšã‚Œç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ä¿æŒå½¢å¼

#### ProcessingArtifact ã®ä¿å­˜å½¢å¼

æ–‡å­—èµ·ã“ã—çµæœã¯ `Format: "json"` ã§ä»¥ä¸‹ã®æ§‹é€ ã‚’ä¿æŒï¼š

```json
{
  "text": "å…¨ä½“ã®ãƒ†ã‚­ã‚¹ãƒˆ",
  "tokens": [
    {
      "text": "ã“ã‚“ã«ã¡ã¯",
      "start_time": 0.0,
      "duration": 0.8
    },
    {
      "text": "ä»Šæ—¥",
      "start_time": 1.2,
      "duration": 0.3
    },
    {
      "text": "ã¯",
      "start_time": 1.5,
      "duration": 0.1
    }
  ],
  "total_duration": 120.5,
  "speaker": "ç”°ä¸­"  // è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
}
```

**ãƒˆãƒ¼ã‚¯ãƒ³ç²’åº¦:**
- Sherpa-ONNXã® `Tokens`/`Timestamps`/`Durations` ã‚’ãã®ã¾ã¾ä¿æŒ
- å˜èªãƒ»ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰å˜ä½ã§ã‚¯ãƒªãƒƒã‚¯å¯èƒ½
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ç§’å˜ä½ï¼ˆfloat32ï¼‰

### éŸ³å£°ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

#### æ–¹å¼: HTTP Range Request

ãƒ–ãƒ©ã‚¦ã‚¶ã® `<audio>` è¦ç´ ã§ã¯ãªãã€Web Audio API + fetch ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**
- è»½é‡ãªå†ç”Ÿåˆ¶å¾¡
- ä»»æ„ã®ä½ç½®ã‹ã‚‰ã®å³æ™‚å†ç”Ÿ
- ã‚«ã‚¹ã‚¿ãƒ UIãŒä½œã‚Šã‚„ã™ã„

#### API

```
GET /api/audio/:source_id/stream
  Headers:
    Range: bytes=0-1048575

  Response:
    206 Partial Content
    Content-Range: bytes 0-1048575/5242880
    Content-Type: audio/wav
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- WAVå½¢å¼ã§é…ä¿¡ï¼ˆå¤‰æ›æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ï¼‰
- Range Requestã§éƒ¨åˆ†å–å¾—
- ç§’â†’ãƒã‚¤ãƒˆä½ç½®ã®å¤‰æ›ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§è¨ˆç®—
  - `byteOffset = seconds * sampleRate * channels * bytesPerSample + headerSize`

### UIè¨­è¨ˆ

#### ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒæœŸãƒšãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šè­°éŒ² 2025-01-15                           [æˆ»ã‚‹] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â–¶ å†ç”Ÿ / â¸ åœæ­¢    â”â”â”â”â”â”â—â”â”â”â”â”â”â”  02:15 / 10:30  â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  [00:00] [ã“ã‚“ã«ã¡ã¯] [ä»Šæ—¥] [ã¯] [å¤©æ°—] [ãŒ] [ã„ã„] â”‚
â”‚           â†‘ å˜èªå˜ä½ã§ã‚¯ãƒªãƒƒã‚¯å¯èƒ½                   â”‚
â”‚  [00:05] [ä»Šæ—¥] [ã®] [è­°é¡Œ] [ã¯] ...    â† å†ç”Ÿä¸­ãƒã‚¤ãƒ©ã‚¤ãƒˆâ”‚
â”‚  [00:12] [ã¾ãš] [æœ€åˆ] [ã«] ...                     â”‚
â”‚  ...                                                â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ©Ÿèƒ½

1. **å˜èªã‚¯ãƒªãƒƒã‚¯ â†’ å†ç”Ÿé–‹å§‹**
   - ã‚¯ãƒªãƒƒã‚¯ã—ãŸå˜èªã® `start_time` ã‹ã‚‰å†ç”Ÿ
   - è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å†ç”Ÿä½ç½®ã‚’è¿½å¾“

2. **å†ç”Ÿä¸­ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ**
   - ç¾åœ¨å†ç”Ÿä¸­ã®å˜èªã‚’è¦–è¦šçš„ã«å¼·èª¿ï¼ˆèƒŒæ™¯è‰²å¤‰æ›´ï¼‰
   - è¤‡æ•°è©±è€…ã®å ´åˆã¯è©±è€…ã”ã¨ã«è‰²åˆ†ã‘

3. **ã‚·ãƒ³ãƒ—ãƒ«ãªå†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**
   - å†ç”Ÿ/åœæ­¢
   - ã‚·ãƒ¼ã‚¯ãƒãƒ¼ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§ä½ç½®ç§»å‹•ï¼‰
   - å†ç”Ÿé€Ÿåº¦å¤‰æ›´ï¼ˆ0.5x, 1x, 1.5x, 2xï¼‰

4. **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**
   - Space: å†ç”Ÿ/åœæ­¢
   - â†/â†’: 5ç§’æˆ»ã‚‹/é€²ã‚€
   - â†‘/â†“: å‰/æ¬¡ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ

### å®Ÿè£…æ–¹é‡

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

```javascript
// Web Audio API ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿ
class AudioStreamer {
  async playFrom(seconds) {
    const byteOffset = this.secondsToBytes(seconds);
    const response = await fetch(`/api/audio/${sourceId}/stream`, {
      headers: { 'Range': `bytes=${byteOffset}-` }
    });
    // AudioContext ã§å†ç”Ÿ
  }
}

// ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
function onSegmentClick(segment) {
  audioStreamer.playFrom(segment.start_time);
  highlightSegment(segment);
}
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```go
// internal/handlers/audio.go
func (h *AudioHandler) Stream(c echo.Context) error {
    sourceID := c.Param("source_id")

    // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—
    source, _ := h.sourceRepo.GetByID(ctx, sourceID)
    filePath := source.FilePath // WAVå½¢å¼

    // Range Requestã‚’å‡¦ç†
    return c.File(filePath) // EchoãŒè‡ªå‹•ã§Rangeå¯¾å¿œ
}
```

### åˆ¶é™äº‹é …

- WAVå½¢å¼ã®ã¿å¯¾å¿œï¼ˆåœ§ç¸®å½¢å¼ã¯ãƒã‚¤ãƒˆä½ç½®è¨ˆç®—ãŒè¤‡é›‘ï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ã®Web Audio APIå¯¾å¿œãŒå¿…è¦
- å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã«æ³¨æ„

### å„ªå…ˆåº¦

ã“ã®æ©Ÿèƒ½ã¯Phase 2ï¼ˆéŸ³å£°å‡¦ç†çµ±åˆï¼‰ã®å¾Œã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ©Ÿèƒ½ã¨ã—ã¦å®Ÿè£…ã€‚
ã‚³ã‚¢æ©Ÿèƒ½ï¼ˆæ–‡å­—èµ·ã“ã—â†’è¨˜äº‹ç”Ÿæˆï¼‰ãŒå‹•ã„ã¦ã‹ã‚‰ç€æ‰‹ã€‚

---

## ä»˜éŒ²D. ã‚¸ãƒ§ãƒ–é€²æ—è¡¨ç¤ºãƒ»ç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦

éŸ³å£°å¤‰æ›ãƒ»æ–‡å­—èµ·ã“ã—ã‚¸ãƒ§ãƒ–ã®é€²æ—çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã—ã€ã‚¸ãƒ§ãƒ–ã®ç®¡ç†ï¼ˆå‰Šé™¤ãªã©ï¼‰ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚

### è¦ä»¶

1. **é€²æ—è¡¨ç¤º**
   - å‡¦ç†ä¸­ã‚¸ãƒ§ãƒ–ã®é€²æ—ç‡ï¼ˆ0-100%ï¼‰ã‚’ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã§è¡¨ç¤º
   - ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤ºï¼ˆä¾‹ï¼šã€ŒéŸ³å£°å¤‰æ›ä¸­ã€ã€Œæ–‡å­—èµ·ã“ã—ä¸­ã€ï¼‰
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰

2. **ã‚¸ãƒ§ãƒ–å‰Šé™¤**
   - ã‚¸ãƒ§ãƒ–ä¸€è¦§ã‹ã‚‰å€‹åˆ¥ã«å‰Šé™¤å¯èƒ½
   - å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
   - å®Ÿè¡Œä¸­ã‚¸ãƒ§ãƒ–ã®å‰Šé™¤ã¯è­¦å‘Šã‚’è¡¨ç¤º

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

æ—¢å­˜ã® `processing_jobs` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ´»ç”¨ï¼š

```sql
-- æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
progress INTEGER DEFAULT 0,    -- é€²æ—ç‡ (0-100)
error TEXT,                    -- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

-- è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
current_step TEXT,             -- ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—å
```

### é€²æ—ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©

éŸ³å£°æ–‡å­—èµ·ã“ã—ã‚¸ãƒ§ãƒ–ã®å ´åˆï¼š

| step | é€²æ—ç¯„å›² | èª¬æ˜ |
|------|---------|------|
| `uploading` | 0-10% | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ä¿å­˜ |
| `converting` | 10-30% | éŸ³å£°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ï¼ˆWAVåŒ–ï¼‰ |
| `transcribing` | 30-90% | æ–‡å­—èµ·ã“ã—å‡¦ç† |
| `saving` | 90-100% | çµæœä¿å­˜ãƒ»è¨˜äº‹ç”Ÿæˆ |

### UIè¨­è¨ˆ

#### ã‚¸ãƒ§ãƒ–ä¸€è¦§ãƒšãƒ¼ã‚¸ (`/jobs`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Processing Jobs                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ”„ transcribe          [running] 15:32:10   [ğŸ—‘]  â”‚
â”‚     abc123-...                                      â”‚
â”‚     æ–‡å­—èµ·ã“ã—ä¸­ (45%)                               â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                            â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ transcribe          [completed] 15:30:22  [ğŸ—‘]  â”‚
â”‚     def456-...                                      â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ— transcribe            [failed] 15:28:05   [ğŸ—‘]  â”‚
â”‚     ghi789-...                                      â”‚
â”‚     Error: failed to convert audio                  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¸ãƒ§ãƒ–ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ã“ã®ã‚¸ãƒ§ãƒ–ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ              â”‚
â”‚  ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚              â”‚
â”‚                                         â”‚
â”‚  âš  ã“ã®ã‚¸ãƒ§ãƒ–ã¯ç¾åœ¨å®Ÿè¡Œä¸­ã§ã™ã€‚         â”‚ â† å®Ÿè¡Œä¸­ã®å ´åˆã®ã¿
â”‚    å‰Šé™¤ã™ã‚‹ã¨å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã™ã€‚        â”‚
â”‚                                         â”‚
â”‚         [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]  [å‰Šé™¤ã™ã‚‹]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APIè¨­è¨ˆ

#### é€²æ—æ›´æ–°ï¼ˆå†…éƒ¨ç”¨ï¼‰

```go
// internal/storage/job_repository.go
func (r *JobRepository) UpdateProgress(ctx context.Context, id string, progress int64) error

// è¿½åŠ 
func (r *JobRepository) UpdateProgressWithStep(ctx context.Context, id string, progress int64, step string) error
```

#### ã‚¸ãƒ§ãƒ–å‰Šé™¤ï¼ˆæ—¢å­˜ï¼‰

```
DELETE /api/jobs/:id
```

### å®Ÿè£…æ–¹é‡

#### 1. ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´

```sql
ALTER TABLE processing_jobs ADD COLUMN current_step TEXT;
```

#### 2. é€²æ—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

```go
// internal/ingestion/audio.go
type ProgressCallback func(progress int, step string)

func (i *AudioIngester) ProcessTranscription(
    ctx context.Context,
    job *sqlc.ProcessingJob,
    onProgress ProgressCallback,  // è¿½åŠ 
) error {
    onProgress(10, "converting")
    // éŸ³å£°å¤‰æ›...

    onProgress(30, "transcribing")
    // æ–‡å­—èµ·ã“ã—...

    onProgress(90, "saving")
    // ä¿å­˜...
}
```

#### 3. ãƒ¯ãƒ¼ã‚«ãƒ¼çµ±åˆ

```go
// internal/worker/worker.go
w.RegisterHandler(storage.JobTypeTranscribe, func(ctx context.Context, job *sqlc.ProcessingJob) error {
    return audioIngester.ProcessTranscription(ctx, job, func(progress int, step string) {
        jobRepo.UpdateProgressWithStep(ctx, job.ID, int64(progress), step)
    })
})
```

#### 4. UIæ›´æ–°

```javascript
// ãƒãƒ¼ãƒªãƒ³ã‚°ã§é€²æ—æ›´æ–°ï¼ˆ3ç§’ã”ã¨ï¼‰
async function pollJobProgress() {
    const response = await fetch('/api/jobs?status=running');
    const jobs = await response.json();
    jobs.forEach(job => updateProgressBar(job.id, job.progress, job.current_step));
}
setInterval(pollJobProgress, 3000);
```

### ã‚¹ãƒ†ãƒƒãƒ—åã®æ—¥æœ¬èªè¡¨ç¤º

```go
var stepLabels = map[string]string{
    "uploading":    "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­",
    "converting":   "éŸ³å£°å¤‰æ›ä¸­",
    "transcribing": "æ–‡å­—èµ·ã“ã—ä¸­",
    "saving":       "ä¿å­˜ä¸­",
}
```

### å„ªå…ˆåº¦

Phase 2å®Œäº†å¾Œã€UXæ”¹å–„ã¨ã—ã¦å®Ÿè£…ã€‚

---

## ä»˜éŒ²E. éŸ³å£°ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†

### èƒŒæ™¯ãƒ»èª²é¡Œ

1. **ReazonSpeechã®åˆ¶é™**: é•·æ™‚é–“éŸ³å£°ã‚’ä¸€æ‹¬å‡¦ç†ã™ã‚‹ã¨å•é¡ŒãŒç™ºç”Ÿ
2. **ãƒ¡ãƒ¢ãƒªå•é¡Œ**: é•·æ™‚é–“éŸ³å£°ã‚’ã¾ã¨ã‚ã¦å‡¦ç†ã™ã‚‹ã¨ãƒ¡ãƒ¢ãƒªä¸è¶³ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
3. **ã‚·ã‚¹ãƒ†ãƒ è² è·**: PCå…¨ä½“ãŒé‡ããªã‚‹
4. **é€²æ—è¡¨ç¤º**: é•·æ™‚é–“å‡¦ç†ä¸­ã«é€²æ—ãŒæ›´æ–°ã•ã‚Œãªã„

### è§£æ±ºç­–

éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§é€æ¬¡å…¥åŠ›ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«èªè­˜çµæœã‚’å–å¾—ã™ã‚‹ã€‚

### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° vs ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²

| æ–¹å¼ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|------|---------|-----------|
| **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | å¢ƒç•Œå•é¡Œãªã—ã€è‡ªç„¶ãªèªè­˜ | å®Ÿè£…ãŒã‚„ã‚„è¤‡é›‘ |
| ãƒãƒ£ãƒ³ã‚¯åˆ†å‰² | å®Ÿè£…ã‚·ãƒ³ãƒ—ãƒ« | ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—å‡¦ç†ãŒå¿…è¦ |

â†’ **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ–¹å¼ã‚’æ¡ç”¨**

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¥åŠ›: audio.wav (10åˆ† = 600ç§’)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éŸ³å£°é•·ã‚’å–å¾— (ffprobe) â†’ é€²æ—è¨ˆç®—ç”¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. WAVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒãƒ•ã‚¡å˜ä½ã§èª­ã¿è¾¼ã¿                    â”‚
â”‚                                                          â”‚
â”‚   while not EOF:                                         â”‚
â”‚     â”œâ”€ ãƒãƒƒãƒ•ã‚¡èª­ã¿è¾¼ã¿ (ä¾‹: 0.5ç§’åˆ† = 8000ã‚µãƒ³ãƒ—ãƒ«)     â”‚
â”‚     â”œâ”€ Recognizerã«ã‚¹ãƒˆãƒªãƒ¼ãƒ å…¥åŠ›                        â”‚
â”‚     â”œâ”€ éƒ¨åˆ†çµæœã‚’å–å¾—ãƒ»è“„ç©                              â”‚
â”‚     â””â”€ é€²æ—æ›´æ–°: 30 + (60 * èª­è¾¼æ¸ˆã¿ / å…¨ä½“é•·) %        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å…¥åŠ›çµ‚äº†ã‚’é€šçŸ¥ â†’ æœ€çµ‚çµæœã‚’å–å¾—                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. çµæœã‚’ä¿å­˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨­å®šå€¤

| é …ç›® | å€¤ | èª¬æ˜ |
|------|-----|------|
| `BUFFER_DURATION` | 0.5ç§’ | 1å›ã®èª­ã¿è¾¼ã¿ã‚µã‚¤ã‚º |
| `SAMPLE_RATE` | 16000 | ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ |
| `BUFFER_SIZE` | 8000 | ãƒãƒƒãƒ•ã‚¡ã‚µãƒ³ãƒ—ãƒ«æ•° (0.5ç§’ Ã— 16000) |

### Sherpa-ONNX ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°API

```go
// Sherpa-ONNX ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°èªè­˜
stream := recognizer.NewStream()
defer stream.Delete()

for {
    samples := readNextBuffer(wavFile)  // 0.5ç§’åˆ†èª­ã¿è¾¼ã¿
    if len(samples) == 0 {
        break
    }

    stream.AcceptWaveform(sampleRate, samples)

    for recognizer.IsReady(stream) {
        recognizer.Decode(stream)
    }

    // éƒ¨åˆ†çµæœã‚’å–å¾—ï¼ˆé€²æ—è¡¨ç¤ºç”¨ï¼‰
    partialResult := recognizer.GetResult(stream)
}

// å…¥åŠ›çµ‚äº†ã‚’é€šçŸ¥
stream.InputFinished()

// æœ€çµ‚ãƒ‡ã‚³ãƒ¼ãƒ‰
for recognizer.IsReady(stream) {
    recognizer.Decode(stream)
}

// æœ€çµ‚çµæœã‚’å–å¾—
finalResult := recognizer.GetResult(stream)
```

### é€²æ—è¨ˆç®—

```go
func calculateProgress(bytesRead, totalBytes int64) int {
    // 30% (é–‹å§‹) â†’ 90% (å®Œäº†)
    ratio := float64(bytesRead) / float64(totalBytes)
    return 30 + int(60*ratio)
}
```

### ãƒ¡ãƒ¢ãƒªç®¡ç†

- å›ºå®šã‚µã‚¤ã‚ºãƒãƒƒãƒ•ã‚¡ï¼ˆ8000ã‚µãƒ³ãƒ—ãƒ« â‰ˆ 16KBï¼‰ã®ã¿ä½¿ç”¨
- çµæœã¯é€æ¬¡è“„ç©ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ã¿ãªã®ã§è»½é‡ï¼‰
- éŸ³å£°å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã¾ãªã„

### å®Ÿè£…å¤‰æ›´ç‚¹

#### 1. å¤‰æ›´: TranscribeFile â†’ TranscribeStream

```go
// internal/asr/recognizer.go
func (r *Recognizer) TranscribeStream(
    wavPath string,
    onProgress func(progressPercent int),
) (*Result, error) {
    // éŸ³å£°é•·ã‚’å–å¾—
    duration, _ := GetAudioDuration(wavPath)
    totalSamples := int64(duration * float32(r.config.SampleRate))

    // WAVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
    file, _ := os.Open(wavPath)
    defer file.Close()

    // ã‚¹ãƒˆãƒªãƒ¼ãƒ ä½œæˆ
    stream := r.recognizer.NewStream()
    defer stream.Delete()

    var processedSamples int64
    buffer := make([]float32, 8000)  // 0.5ç§’åˆ†

    for {
        n := readSamples(file, buffer)
        if n == 0 {
            break
        }

        stream.AcceptWaveform(r.config.SampleRate, buffer[:n])

        for r.recognizer.IsReady(stream) {
            r.recognizer.Decode(stream)
        }

        processedSamples += int64(n)
        progress := 30 + int(60*processedSamples/totalSamples)
        onProgress(progress)
    }

    stream.InputFinished()
    // ... æœ€çµ‚çµæœå–å¾—
}
```

#### 2. å¤‰æ›´ãªã—: ProcessTranscription

AudioIngesterã¯TranscribeStreamã‚’å‘¼ã¶ã ã‘ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åŒã˜ï¼‰

### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

| é …ç›® | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|------|--------|--------|
| 10åˆ†éŸ³å£°ã®å‡¦ç† | ã‚¯ãƒ©ãƒƒã‚·ãƒ¥/ãƒ•ãƒªãƒ¼ã‚º | æ­£å¸¸å®Œäº† |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | éŸ³å£°é•·ã«æ¯”ä¾‹ | ä¸€å®šï¼ˆã€œ16KBï¼‰ |
| é€²æ—è¡¨ç¤º | 30%ã§åœæ­¢ | 0.5ç§’ã”ã¨ã«æ›´æ–° |
| ã‚·ã‚¹ãƒ†ãƒ è² è· | PCå…¨ä½“ãŒé‡ã„ | è»½å¾® |
| å¢ƒç•Œå•é¡Œ | ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—å¿…è¦ | ãªã— |

### å„ªå…ˆåº¦

å³åº§ã«å¯¾å¿œãŒå¿…è¦ã€‚ç¾çŠ¶ã§ã¯é•·ã„éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡¦ç†ã§ããªã„ã€‚

---

## Appendix F: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å‹ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¡¨ç¤º

### èƒŒæ™¯

ç¾åœ¨ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºã§ã¯ã€éŸ³å£°ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒãã®ã¾ã¾è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ï¼š
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–“ã«æ™‚é–“ã®é£›ã³ãŒã‚ã‚‹ï¼ˆä¾‹: 9.82ç§’ â†’ 13.65ç§’ï¼‰
- ç„¡éŸ³åŒºé–“ãŒã©ã“ã«ã‚ã‚‹ã‹è¦–è¦šçš„ã«åˆ†ã‹ã‚‰ãªã„
- ãƒ†ã‚­ã‚¹ãƒˆã®å¯†åº¦ãŒä¸€æ§˜ã«è¦‹ãˆã¦ã—ã¾ã†

### è¦ä»¶

1. **é€£ç¶šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º**
   - éŸ³å£°å…¨ä½“ã‚’ä¸€å®šé–“éš”ï¼ˆä¾‹: 10ç§’ï¼‰ã§åŒºåˆ‡ã£ãŸã€Œè¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆã€ã¨ã—ã¦è¡¨ç¤º
   - æ™‚é–“ã®é£›ã³ã‚’ãªãã—ã€é€£ç¶šçš„ãªã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’æä¾›

2. **ç„¡éŸ³åŒºé–“ã®å¯è¦–åŒ–**
   - ãƒ†ã‚­ã‚¹ãƒˆãŒå­˜åœ¨ã—ãªã„æ™‚é–“å¸¯ã‚’ `ãƒ»` ã§åŸ‹ã‚ã‚‹
   - ç„¡éŸ³ã®é•·ã•ã«å¿œã˜ã¦ `ãƒ»` ã®æ•°ã‚’èª¿æ•´
   - ä¾‹: 0.5ç§’ã®ç„¡éŸ³ â†’ `ãƒ»ãƒ»ãƒ»`

3. **ãƒ†ã‚­ã‚¹ãƒˆä½ç½®ã®å¯è¦–åŒ–**
   - è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã§ã®ãƒ†ã‚­ã‚¹ãƒˆã®ç›¸å¯¾ä½ç½®ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«
   - æ–‡å­—ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ä½ç½®ã‹ã‚‰å†ç”Ÿï¼ˆæ—¢å­˜æ©Ÿèƒ½ç¶­æŒï¼‰

### è¡¨ç¤ºå½¢å¼

**ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºï¼ˆä¸€å®šé–“éš”ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰:**
```
[00:00-00:10] å­¦å¹´æœ«ã¯ã¾ã äºŒæœˆã«å…¥è©¦ã®ä¼‘ã¿ãŒã‚ã‚‹ã®ã§ãƒ»ãƒ»ãƒ»ãƒ»
[00:10-00:20] ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ä¼‘ã¿ã‚‚æŒŸã¿ã¾ã™ã‹ã‚‰ã„ã„ã‚“ã§ã™ã‘ã©ãƒ»ãƒ»ä»Šå›ãŒä¸€ç•ªéŸ¿ã‹ã¨æ€ã„ã¾ã™
[00:20-00:30] ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
[00:30-00:40] æ™®é€šåæœˆã®ä¸­é ƒã«ä¸­é–“ã‚’ã‚„ã‚‹ã‚“ã§ã™ã‘ã©ãƒ»ãƒ»å¤šåˆ†
[00:40-00:50] ãƒ»äºŒæœŸç”Ÿãªã®ã§ãƒ»ãƒ»ãƒ»å½¢ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ã¯ã„
[00:50-01:00] ãƒ»ãƒ»ã‚ã‚Šã¾ã—ãŸãƒ»ãƒ»ãƒ»è½ã¨ã™ã®
```

**ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±è¡¨ç¤ºï¼ˆãƒˆã‚°ãƒ«å¯èƒ½ï¼‰:**
```
[00:00-00:10] å­¦å¹´æœ«ã¯ã¾ã äºŒæœˆã«å…¥è©¦ã®ä¼‘ã¿ãŒã‚ã‚‹ã®ã§ãƒ»ãƒ»ãƒ»ãƒ»
              â””â”€â”€ seg1: 0.13-9.82 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[00:10-00:20] ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ä¼‘ã¿ã‚‚æŒŸã¿ã¾ã™ã‹ã‚‰ã„ã„ã‚“ã§ã™ã‘ã©ãƒ»ãƒ»ä»Šå›ãŒä¸€ç•ªéŸ¿ã‹ã¨æ€ã„ã¾ã™
              â””â”€ seg2: 13.65-17.21 â”€â”˜â””â”€ seg3: 17.81-20.94 â”€â”˜
```

- å…ƒã®ASRã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¢ƒç•Œã‚’ä¸‹ç·šã§è¡¨ç¤º
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤ºON/OFFåˆ‡æ›¿å¯èƒ½

### å®Ÿè£…æ–¹é‡

#### 1. è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆ

```go
type DisplaySegment struct {
    StartTime    float64   // è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®é–‹å§‹æ™‚åˆ»
    EndTime      float64   // è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®çµ‚äº†æ™‚åˆ»
    Elements     []Element // è¡¨ç¤ºè¦ç´ ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯ç„¡éŸ³ï¼‰
}

type Element struct {
    Type      string  // "text" or "silence"
    Text      string  // ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ï¼ˆtype=textæ™‚ï¼‰
    StartTime float64 // é–‹å§‹æ™‚åˆ»
    Duration  float64 // é•·ã•
}
```

#### 2. ç„¡éŸ³ã®æ¤œå‡ºãƒ«ãƒ¼ãƒ«

- ãƒˆãƒ¼ã‚¯ãƒ³é–“ã®ã‚®ãƒ£ãƒƒãƒ— > 0.3ç§’ ã®å ´åˆã€ç„¡éŸ³ã¨ã¿ãªã™
- ç„¡éŸ³1ç§’ã‚ãŸã‚Š `ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»` (5æ–‡å­—) ã§è¡¨ç¾
- æœ€å°è¡¨ç¤º: `ãƒ»`ï¼ˆ0.2ç§’æœªæº€ï¼‰

#### 3. è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¹…

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ç§’
- è¨­å®šå¯èƒ½ï¼ˆ5ç§’ã€10ç§’ã€30ç§’ã€60ç§’ï¼‰
- çŸ­ã„éŸ³å£°ã¯å…¨ä½“ã‚’1ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§è¡¨ç¤º

### UIè¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–¶] â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 2:15 / 5:30  [1x â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Interval: [10s â–¼]   â˜‘ Show segment info                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [00:00-00:10] å­¦å¹´æœ«ã¯ã¾ã äºŒæœˆã«å…¥è©¦ã®ä¼‘ã¿ãŒã‚ã‚‹ã®ã§ãƒ»ãƒ»â”‚
â”‚               â””â”€â”€ seg1: 0.13-9.82 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ [00:10-00:20] ãƒ»ãƒ»ãƒ»ãƒ»ä¼‘ã¿ã‚‚æŒŸã¿ã¾ã™ã‹ã‚‰...            â”‚ â† ç¾åœ¨å†ç”Ÿä¸­
â”‚               â””â”€ seg2: 13.65-17.21 â”€â”˜                   â”‚
â”‚ [00:20-00:30] ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»             â”‚
â”‚ [00:30-00:40] æ™®é€šåæœˆã®ä¸­é ƒã«...                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«:**
- `Interval`: è¡¨ç¤ºé–“éš”ï¼ˆ5s/10s/30s/60sï¼‰
- `Show segment info`: ASRã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±ã®è¡¨ç¤ºON/OFF

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
- å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«éƒ¨åˆ†ã¯ `position: sticky; top: 0` ã§å›ºå®š
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã‚‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯å¸¸æ™‚è¡¨ç¤º
- ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆéƒ¨åˆ†ã®ã¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

| æ“ä½œ | å‹•ä½œ |
|------|------|
| ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒªãƒƒã‚¯ | ãã®æ–‡å­—ã®æ™‚åˆ»ã‹ã‚‰å†ç”Ÿé–‹å§‹ |
| `ãƒ»` ã‚¯ãƒªãƒƒã‚¯ | ãã®ç„¡éŸ³åŒºé–“ã®é–‹å§‹æ™‚åˆ»ã‹ã‚‰å†ç”Ÿ |
| ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ˜ãƒƒãƒ€ã‚¯ãƒªãƒƒã‚¯ | ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–‹å§‹æ™‚åˆ»ã‹ã‚‰å†ç”Ÿ |

### è‰²åˆ†ã‘

| è¦ç´  | è‰² |
|------|-----|
| ç¾åœ¨å†ç”Ÿä¸­ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ | è–„é’èƒŒæ™¯ `bg-blue-50` |
| ç¾åœ¨å†ç”Ÿä¸­ã®æ–‡å­— | é»„è‰²èƒŒæ™¯ `bg-yellow-200` |
| ç„¡éŸ³ãƒãƒ¼ã‚«ãƒ¼ `ãƒ»` | è–„ã„ã‚°ãƒ¬ãƒ¼ `text-gray-300` |
| æ™‚åˆ»ãƒ©ãƒ™ãƒ« | ã‚°ãƒ¬ãƒ¼ `text-gray-400` |

### å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

1. **DisplaySegmentç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯** (`internal/asr/display.go`)
   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
   - è¡¨ç¤ºã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¹…ã§åˆ†å‰²
   - ãƒˆãƒ¼ã‚¯ãƒ³é–“ã‚®ãƒ£ãƒƒãƒ—ã«ç„¡éŸ³ãƒãƒ¼ã‚«ãƒ¼æŒ¿å…¥

2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°** (`web/components/transcript_sync.templ`)
   - æ–°ã—ã„è¡¨ç¤ºå½¢å¼ã«å¯¾å¿œ
   - ç„¡éŸ³ãƒãƒ¼ã‚«ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

3. **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¹…é¸æŠUI**
   - ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§é¸æŠå¯èƒ½ã«

---

## Appendix G: VAD+ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹æ–‡å­—èµ·ã“ã—

### èƒŒæ™¯ãƒ»èª²é¡Œ

ç¾åœ¨ã®ãƒãƒ£ãƒ³ã‚¯ãƒ™ãƒ¼ã‚¹å‡¦ç†ã§ã¯ã€ä»¥ä¸‹ã®å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ï¼š

1. **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®ä¸æ­£ç¢ºã•**: å›ºå®š20ç§’ãƒãƒ£ãƒ³ã‚¯ã§å‡¦ç†ã™ã‚‹ã¨ã€ç„¡éŸ³åŒºé–“ã‚’è·¨ãéš›ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒãšã‚Œã‚‹
2. **ç„¡éŸ³åŒºé–“ã§ã®èª¤èªè­˜**: ãƒãƒ£ãƒ³ã‚¯å†…ã«ç„¡éŸ³ãŒã‚ã‚‹ã¨ã€ãƒ¢ãƒ‡ãƒ«ãŒä¸æ­£ç¢ºãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ¨å®š
3. **ãƒãƒ£ãƒ³ã‚¯å¢ƒç•Œå•é¡Œ**: éŸ³å£°ãŒé€”ä¸­ã§åˆ‡ã‚Œã€èªè­˜ç²¾åº¦ãŒä½ä¸‹

**å…·ä½“ä¾‹:**
```
éŸ³å£°: "...ã™" â†’ ç´„20ç§’ã®ç„¡éŸ³ â†’ "ãªã‚“..."
æœŸå¾…: "ã™"=158s, "ãªã‚“"=179s
å®Ÿéš›: "ã™"=158s, "ãª"=169s(èª¤), "ã‚“"=179s
```

### è§£æ±ºç­–: VAD+ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹å‡¦ç†

**åŸºæœ¬ã‚¢ã‚¤ãƒ‡ã‚¢:**
éŸ³å£°æ´»å‹•æ¤œå‡ºï¼ˆVADï¼‰ã§ç™ºè©±åŒºé–“ã‚’æ¤œå‡ºã—ã€å„ç™ºè©±ãƒ–ãƒ­ãƒƒã‚¯ã‚’å˜ä½ã¨ã—ã¦æ–‡å­—èµ·ã“ã—ã™ã‚‹ã€‚

```
å…¥åŠ›éŸ³å£°: [ç™ºè©±1]----ç„¡éŸ³----[ç™ºè©±2]----ç„¡éŸ³----[ç™ºè©±3]
             â†“                  â†“                  â†“
VADæ¤œå‡º:  Block1(0-10s)    Block2(30-45s)    Block3(60-80s)
             â†“                  â†“                  â†“
æ–‡å­—èµ·ã“ã—:  Result1           Result2           Result3
             â†“                  â†“                  â†“
çµåˆ:     å…¨çµæœã‚’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—é †ã«ãƒãƒ¼ã‚¸
```

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

#### Phase 1: VAD+é€æ¬¡å‡¦ç†ï¼ˆåˆæœŸå®Ÿè£…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. VADæ¤œå‡ºï¼ˆSilero VADï¼‰                                 â”‚
â”‚    - ç™ºè©±åŒºé–“ã‚’æ¤œå‡º                                       â”‚
â”‚    - Block: { start_time, end_time }                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’é€æ¬¡å‡¦ç†                                   â”‚
â”‚                                                          â”‚
â”‚    for block in blocks:                                  â”‚
â”‚      â”œâ”€ ffmpegã§ãƒ–ãƒ­ãƒƒã‚¯åŒºé–“ã‚’æŠ½å‡º                        â”‚
â”‚      â”œâ”€ tempoèª¿æ•´ï¼ˆå¿…è¦ãªå ´åˆï¼‰                           â”‚
â”‚      â”œâ”€ Sherpa-ONNX offline recognizerã§æ–‡å­—èµ·ã“ã—       â”‚
â”‚      â”œâ”€ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å…ƒã®éŸ³å£°æ™‚åˆ»ã«å¤‰æ›                â”‚
â”‚      â””â”€ é€²æ—æ›´æ–°: 30 + (60 * å‡¦ç†æ¸ˆã¿ / å…¨ãƒ–ãƒ­ãƒƒã‚¯) %    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. çµæœãƒãƒ¼ã‚¸                                             â”‚
â”‚    - å…¨ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ™‚é–“é †ã§ã‚½ãƒ¼ãƒˆ                  â”‚
â”‚    - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. çµæœä¿å­˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Phase 2: ä¸¦åˆ—å‡¦ç†ï¼ˆå°†æ¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Recognizer Pool                                          â”‚
â”‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Recognizer1 â”‚  â”‚ Recognizer2 â”‚  â”‚ Recognizer3 â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                â”‚                â”‚              â”‚
â”‚         â–¼                â–¼                â–¼              â”‚
â”‚     Block1           Block2           Block3            â”‚
â”‚         â”‚                â”‚                â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚                    çµæœãƒãƒ¼ã‚¸                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- è¤‡æ•°Recognizerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ—ãƒ¼ãƒ«ç®¡ç†
- ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦åˆ—å‡¦ç†ã—ã¦å…¨ä½“æ™‚é–“ã‚’çŸ­ç¸®
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¨ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚’è€ƒæ…®

### VADè¨­å®š

#### Silero VAD

```go
type VADConfig struct {
    ModelPath     string  // silero_vad.onnx
    Threshold     float32 // ç™ºè©±åˆ¤å®šé–¾å€¤ (default: 0.5)
    MinSpeechDur  float32 // æœ€å°ç™ºè©±é•·ï¼ˆç§’ï¼‰ (default: 0.25)
    MinSilenceDur float32 // æœ€å°ç„¡éŸ³é•·ï¼ˆç§’ï¼‰ (default: 0.5)
    SampleRate    int     // 16000
}
```

**å‡ºåŠ›:**
```go
type SpeechBlock struct {
    StartTime float64 // ç™ºè©±é–‹å§‹æ™‚åˆ»ï¼ˆç§’ï¼‰
    EndTime   float64 // ç™ºè©±çµ‚äº†æ™‚åˆ»ï¼ˆç§’ï¼‰
}
```

### ãƒ–ãƒ­ãƒƒã‚¯å‡¦ç†

#### å‡¦ç†å˜ä½

- VADã§æ¤œå‡ºã•ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ã‚’ãã®ã¾ã¾1å˜ä½ã¨ã—ã¦å‡¦ç†
- ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²ã¯è¡Œã‚ãªã„ï¼ˆå¢ƒç•Œå•é¡Œã‚’å›é¿ï¼‰
- é•·ã„ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ>60ç§’ï¼‰ã¯å°†æ¥çš„ã«æ¤œè¨

#### ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å¤‰æ›

```go
// ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å…ƒã®éŸ³å£°æ™‚åˆ»ã«å¤‰æ›
func adjustTimestamp(token Token, blockStart float64, tempo float64) Token {
    return Token{
        Text:      token.Text,
        StartTime: float32(blockStart + float64(token.StartTime)*tempo),
        Duration:  token.Duration * float32(tempo),
    }
}
```

### å®Ÿè£…è¨ˆç”»

#### Phase 1ï¼ˆåˆæœŸï¼‰

1. **VADçµ±åˆ**
   - Silero VADãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰
   - éŸ³å£°ã‹ã‚‰SpeechBlocké…åˆ—ã‚’å–å¾—

2. **ãƒ–ãƒ­ãƒƒã‚¯å‡¦ç†**
   - ffmpegã§ãƒ–ãƒ­ãƒƒã‚¯åŒºé–“ã‚’æŠ½å‡º
   - æ—¢å­˜ã®offline recognizerã§æ–‡å­—èµ·ã“ã—
   - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—èª¿æ•´

3. **çµæœãƒãƒ¼ã‚¸**
   - ãƒˆãƒ¼ã‚¯ãƒ³é…åˆ—ã‚’æ™‚é–“é †ã‚½ãƒ¼ãƒˆ
   - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†ç”Ÿæˆ

4. **æ–¹å¼åˆ‡ã‚Šæ›¿ãˆ**
   - æ—¢å­˜ã®ãƒãƒ£ãƒ³ã‚¯ãƒ™ãƒ¼ã‚¹æ–¹å¼ï¼ˆ`TranscribeTempo`ï¼‰ã¯æ®‹ã™
   - VADæ–¹å¼ï¼ˆ`TranscribeWithVAD`ï¼‰ã‚’æ–°è¦è¿½åŠ 
   - å‘¼ã³å‡ºã—å´ã§æ–¹å¼ã‚’é¸æŠå¯èƒ½ã«

5. **å®Ÿé¨“ã‚³ãƒãƒ³ãƒ‰**
   - `cmd/transcribe-vad/` ã§å˜ä½“ãƒ†ã‚¹ãƒˆå¯èƒ½ã«
   - æ—¢å­˜ `cmd/transcribe/` ã¯ãã®ã¾ã¾ç¶­æŒ

#### Phase 2ï¼ˆå°†æ¥ï¼‰

1. **Recognizer Pool**
   - è¨­å®šå¯èƒ½ãªãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º
   - ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†åˆ©ç”¨

2. **ä¸¦åˆ—å‡¦ç†**
   - goroutineã§ãƒ–ãƒ­ãƒƒã‚¯ä¸¦åˆ—å‡¦ç†
   - çµæœãƒãƒ£ãƒãƒ«ã§åé›†

3. **é•·æ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯å¯¾å¿œ**
   - 60ç§’è¶…ã®ãƒ–ãƒ­ãƒƒã‚¯ã®åˆ†å‰²æˆ¦ç•¥

### è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```go
type TranscriptionConfig struct {
    // VADè¨­å®š
    VADModelPath     string  // Silero VADãƒ¢ãƒ‡ãƒ«ãƒ‘ã‚¹
    VADThreshold     float32 // ç™ºè©±åˆ¤å®šé–¾å€¤ (0.5)
    MinSpeechDur     float32 // æœ€å°ç™ºè©±é•· (0.25ç§’)
    MinSilenceDur    float32 // æœ€å°ç„¡éŸ³é•· (0.5ç§’)

    // ASRè¨­å®š
    Tempo            float64 // éŸ³å£°ãƒ†ãƒ³ãƒ (0.85-1.0)

    // å°†æ¥: ä¸¦åˆ—å‡¦ç†è¨­å®š
    // PoolSize         int     // Recognizerãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º
    // MaxBlockDuration float64 // æœ€å¤§ãƒ–ãƒ­ãƒƒã‚¯é•·ï¼ˆç§’ï¼‰
}
```

### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

| é …ç›® | æ”¹å–„å‰ï¼ˆãƒãƒ£ãƒ³ã‚¯æ–¹å¼ï¼‰ | æ”¹å–„å¾Œï¼ˆVADæ–¹å¼ï¼‰ |
|------|----------------------|------------------|
| ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç²¾åº¦ | ç„¡éŸ³åŒºé–“ã§ãšã‚Œã‚‹ | é«˜ç²¾åº¦ |
| å¢ƒç•Œå•é¡Œ | ç™ºç”Ÿã™ã‚‹ | ãªã— |
| ç„¡éŸ³åŒºé–“å‡¦ç† | ä¸è¦ãªå‡¦ç†ãŒèµ°ã‚‹ | ã‚¹ã‚­ãƒƒãƒ— |
| å‡¦ç†åŠ¹ç‡ | ä¸€å®š | ç™ºè©±åŒºé–“ã®ã¿å‡¦ç† |

### å„ªå…ˆåº¦

Phase 1: å³åº§ã«å¯¾å¿œãŒå¿…è¦ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç²¾åº¦å•é¡Œã®æ ¹æœ¬è§£æ±ºï¼‰
Phase 2: æ€§èƒ½è¦ä»¶ã«å¿œã˜ã¦å¾Œæ—¥å®Ÿè£…

---

**ä»•æ§˜æ›¸ çµ‚ã‚ã‚Š**
